{% extends "base.html" %} {% block title %}B√†i t·∫≠p - UEd AiTutor{% endblock %} {% block page_title %}B√†i t·∫≠p{% endblock %} {% block content %}
<div class="assignments-container">
    <!-- Header with filters and actions -->
    <div class="card mb-6">
        <div class="card-body">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h2 class="text-xl font-bold">Danh s√°ch b√†i t·∫≠p</h2>
                    <p class="text-sm text-gray-600">
                        {% if current_user.role == 'student' %} C√°c b√†i t·∫≠p t·ª´ kh√≥a h·ªçc b·∫°n ƒëang theo h·ªçc {% else %} C√°c b√†i t·∫≠p b·∫°n ƒë√£ t·∫°o {% endif %}
                    </p>
                </div>
                {% if current_user.is_instructor() %}
                <a href="#" class="btn btn-primary">
                    <span>‚ûï</span> T·∫°o b√†i t·∫≠p m·ªõi
                </a>
                {% endif %}
            </div>

            <!-- Filters -->
            <div class="flex gap-4">
                <div class="form-group">
                    <select class="form-select">
                        <option value="">T·∫•t c·∫£ ng√¥n ng·ªØ</option>
                        <option value="python">Python</option>
                        <option value="java">Java</option>
                        <option value="cpp">C++</option>
                        <option value="javascript">JavaScript</option>
                    </select>
                </div>
                <div class="form-group">
                    <select class="form-select">
                        <option value="">T·∫•t c·∫£ ƒë·ªô kh√≥</option>
                        <option value="beginner">C∆° b·∫£n</option>
                        <option value="intermediate">Trung b√¨nh</option>
                        <option value="advanced">N√¢ng cao</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="text" class="form-input" placeholder="T√¨m ki·∫øm b√†i t·∫≠p...">
                </div>
            </div>
        </div>
    </div>

    <!-- Assignments Grid -->
    {% if assignments %}
    <div class="assignment-grid">
        {% for assignment in assignments %}
        <div class="assignment-card">
            <div class="assignment-header">
                <h3 class="assignment-title">{{ assignment.title }}</h3>
                <div class="assignment-meta">
                    <span class="text-sm text-gray-600">{{ assignment.course.title }}</span> {% if assignment.due_date %}
                    <span class="badge badge-{{ 'error' if assignment.due_date < moment() else 'warning' }}">
                        {% if assignment.due_date < moment() %}
                            ƒê√£ h·∫øt h·∫°n
                        {% else %}
                            H·∫øt h·∫°n: {{ assignment.due_date.strftime('%d/%m/%Y') }}
                        {% endif %}
                    </span> {% endif %}
                </div>
            </div>

            <div class="assignment-body">
                <p class="assignment-description">{{ assignment.description[:150] }}...</p>

                <div class="assignment-tags">
                    <span class="badge badge-primary">{{ assignment.language|title }}</span>
                    <span class="badge badge-secondary">{{ assignment.difficulty_level|title }}</span> {% if assignment.assignment_type != 'coding' %}
                    <span class="badge badge-info">{{ assignment.assignment_type|title }}</span> {% endif %}
                </div>

                <div class="assignment-stats">
                    <div class="flex items-center gap-4 text-sm text-gray-600">
                        <span>‚è±Ô∏è {{ assignment.time_limit }} ph√∫t</span>
                        <span>üéØ {{ assignment.points_possible }} ƒëi·ªÉm</span>
                        <span>üîÑ {{ assignment.max_attempts }} l·∫ßn th·ª≠</span>
                    </div>
                </div>
            </div>

            <div class="assignment-footer">
                <div class="assignment-progress">
                    {% if current_user.role == 'student' %} {% set user_submissions = assignment.submissions | selectattr('user_id', 'equalto', current_user.id) | list %} {% if user_submissions %} {% set best_submission = user_submissions | sort(attribute='score', reverse=true)
                    | first %}
                    <span class="text-sm">
                                ƒêi·ªÉm cao nh·∫•t: {{ "%.1f"|format(best_submission.score) if best_submission.score else 0 }}/{{ assignment.points_possible }}
                            </span> {% else %}
                    <span class="text-sm text-gray-500">Ch∆∞a n·ªôp b√†i</span> {% endif %} {% else %}
                    <span class="text-sm">
                            {{ assignment.submissions | length }} b√†i n·ªôp
                        </span> {% endif %}
                </div>

                <div class="assignment-actions">
                    {% if current_user.role == 'student' %} {% set user_submissions = assignment.submissions | selectattr('user_id', 'equalto', current_user.id) | list %} {% if user_submissions | length >= assignment.max_attempts %}
                    <button class="btn btn-sm btn-outline" disabled>H·∫øt l·∫ßn th·ª≠</button> {% elif assignment.due_date and assignment.due_date
                    < moment() %} <button class="btn btn-sm btn-outline" disabled>ƒê√£ h·∫øt h·∫°n</button>
                        {% else %}
                        <a href="#" class="btn btn-sm btn-primary">
                                {% if user_submissions %}Th·ª≠ l·∫°i{% else %}B·∫Øt ƒë·∫ßu{% endif %}
                            </a> {% endif %} {% else %}
                        <a href="#" class="btn btn-sm btn-outline">Xem chi ti·∫øt</a>
                        <a href="#" class="btn btn-sm btn-primary">Ch·ªânh s·ª≠a</a> {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="card">
        <div class="card-body text-center">
            <div class="mb-4">
                <span style="font-size: 4rem;">üìù</span>
            </div>
            <h3 class="text-xl font-bold mb-2">Ch∆∞a c√≥ b√†i t·∫≠p n√†o</h3>
            <p class="text-gray-600 mb-4">
                {% if current_user.role == 'student' %} B·∫°n ch∆∞a ƒë∆∞·ª£c giao b√†i t·∫≠p n√†o ho·∫∑c ch∆∞a tham gia kh√≥a h·ªçc n√†o. {% else %} B·∫°n ch∆∞a t·∫°o b√†i t·∫≠p n√†o. H√£y t·∫°o b√†i t·∫≠p ƒë·∫ßu ti√™n! {% endif %}
            </p>
            {% if current_user.is_instructor() %}
            <a href="#" class="btn btn-primary">
                <span>‚ûï</span> T·∫°o b√†i t·∫≠p ƒë·∫ßu ti√™n
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}