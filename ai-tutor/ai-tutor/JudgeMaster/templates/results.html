{% extends "base.html" %} {% block title %}K·∫øt qu·∫£ - UEd AiTutor{% endblock %} {% block page_title %}K·∫øt qu·∫£{% endblock %} {% block content %}
<div class="results-container">
    <!-- Header -->
    <div class="card mb-6">
        <div class="card-body">
            <h2 class="text-xl font-bold mb-2">K·∫øt qu·∫£ b√†i t·∫≠p</h2>
            <p class="text-sm text-gray-600">
                {% if current_user.role == 'student' %} L·ªãch s·ª≠ n·ªôp b√†i v√† ƒëi·ªÉm s·ªë c·ªßa b·∫°n {% else %} K·∫øt qu·∫£ t·ª´ c√°c b√†i t·∫≠p b·∫°n ƒë√£ t·∫°o {% endif %}
            </p>
        </div>
    </div>

    <!-- Results Table -->
    {% if submissions %}
    <div class="card">
        <div class="card-body">
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            {% if current_user.is_instructor() %}
                            <th>H·ªçc sinh</th>
                            {% endif %}
                            <th>B√†i t·∫≠p</th>
                            <th>Kh√≥a h·ªçc</th>
                            <th>ƒêi·ªÉm s·ªë</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>Th·ªùi gian n·ªôp</th>
                            <th>Th·ªùi gian th·ª±c thi</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for submission in submissions %}
                        <tr>
                            {% if current_user.is_instructor() %}
                            <td>{{ submission.user.display_name or submission.user.full_name }}</td>
                            {% endif %}
                            <td>
                                <div class="font-medium">{{ submission.assignment.title }}</div>
                                <div class="text-sm text-gray-600">L·∫ßn th·ª≠ {{ submission.attempt_number }}</div>
                            </td>
                            <td>{{ submission.assignment.course.title }}</td>
                            <td>
                                {% if submission.score is not none %}
                                <div class="flex items-center gap-2">
                                    <span class="font-bold">{{ "%.1f"|format(submission.score) }}</span>
                                    <span class="text-gray-500">/{{ submission.max_score or submission.assignment.points_possible }}</span>
                                    <div class="w-16 h-2 bg-gray-200 rounded">
                                        {% set percentage = (submission.score / (submission.max_score or submission.assignment.points_possible)) * 100 %}
                                        <div class="h-full rounded bg-{{ 'success' if percentage >= 80 else 'warning' if percentage >= 60 else 'error' }}-500" style="width: {{ percentage }}%"></div>
                                    </div>
                                </div>
                                {% else %}
                                <span class="text-gray-500">-</span> {% endif %}
                            </td>
                            <td>
                                {% if submission.status == 'completed' %}
                                <span class="badge badge-success">Ho√†n th√†nh</span> {% elif submission.status == 'grading' %}
                                <span class="badge badge-warning">ƒêang ch·∫•m</span> {% elif submission.status == 'error' %}
                                <span class="badge badge-error">L·ªói</span> {% else %}
                                <span class="badge badge-secondary">{{ submission.status|title }}</span> {% endif %} {% if submission.is_late %}
                                <span class="badge badge-warning">N·ªôp mu·ªôn</span> {% endif %}
                            </td>
                            <td>{{ submission.submission_time.strftime('%d/%m/%Y %H:%M') }}</td>
                            <td>
                                {% if submission.execution_time %} {{ "%.3f"|format(submission.execution_time) }}s {% else %} - {% endif %}
                            </td>
                            <td>
                                <div class="flex gap-2">
                                    <a href="#" class="btn btn-sm btn-outline">Xem chi ti·∫øt</a> {% if current_user.is_instructor() %}
                                    <a href="#" class="btn btn-sm btn-primary">Ch·∫•m l·∫°i</a> {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% else %}
    <div class="card">
        <div class="card-body text-center">
            <div class="mb-4">
                <span style="font-size: 4rem;">üìä</span>
            </div>
            <h3 class="text-xl font-bold mb-2">Ch∆∞a c√≥ k·∫øt qu·∫£ n√†o</h3>
            <p class="text-gray-600 mb-4">
                {% if current_user.role == 'student' %} B·∫°n ch∆∞a n·ªôp b√†i t·∫≠p n√†o. H√£y b·∫Øt ƒë·∫ßu l√†m b√†i t·∫≠p ƒë·∫ßu ti√™n! {% else %} Ch∆∞a c√≥ h·ªçc sinh n√†o n·ªôp b√†i trong c√°c kh√≥a h·ªçc c·ªßa b·∫°n. {% endif %}
            </p>
            {% if current_user.role == 'student' %}
            <a href="{{ url_for('assignments') }}" class="btn btn-primary">
                <span>üìù</span> Xem b√†i t·∫≠p
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}